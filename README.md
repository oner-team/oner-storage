# natty-storage

storage plus for javascript

> ğŸ» å¼€å‘è€…çš„ä½“éªŒè‡³å…³é‡è¦ï¼  
> `natty`ç³»åˆ—çš„å°å·¥å…·ï¼Œä»¥å‚ç›´çš„æ€è·¯å’Œå·¥åŒ çš„ç²¾ç¥ï¼Œåœ¨å¾®å°çš„æŠ€æœ¯ç‚¹ä¸Šè¿½æ±‚æè‡´çš„å¼€å‘ä½“éªŒã€‚å¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè€ƒè™‘æ”¯æŒä¸€ä¸‹å§ :D

## ç‰¹ç‚¹

* æ”¯æŒå¼‚æ­¥æ–¹å¼ä½¿ç”¨`localStorage`å’Œ`sessionStorage`ï¼Œé¿å…é˜»å¡ï¼Œå¹¶ä¼˜é›…åœ°æ•è·å¼‚å¸¸(å¦‚è¶…å‡ºæµè§ˆå™¨æœ€å¤§é™åˆ¶)ã€‚å½“ç„¶ï¼ŒåŒæ­¥æ–¹å¼ä½¿ç”¨ä¾ç„¶æ˜¯é»˜è®¤çš„ä½¿ç”¨æ–¹å¼ã€‚
* æ”¯æŒä»¥è·¯å¾„(`Path`)æ–¹å¼è®¾ç½®ã€è·å–å’Œåˆ é™¤æ•°æ®ï¼Œç›¸å¯¹äºç›´æ¥ä½¿ç”¨åŸç”Ÿ`localStorage/sessionStorage`å¯¹è±¡ï¼Œå¤§å¤§å‡å°‘äº†ä»£ç é‡ã€‚
* å°è£…äº†ä¸‰ç§æœ‰æ•ˆæ€§åˆ¤æ–­ï¼Œæ ‡è®°(`tag`)ã€æœ‰æ•ˆæœŸé•¿(`duration`)ã€æœ‰æ•ˆæœŸè‡³(`until`)ï¼Œä¸å†é‡å¤ç¼–ç ã€‚
* éšèº«æ¨¡å¼ä¸‹ï¼Œæœ‰äº›æµè§ˆå™¨ä¸æ”¯æŒ`localStorage`ï¼Œæ­¤æ—¶è‡ªåŠ¨é™çº§ä¸º`variable`æ¨¡å¼ã€‚
* `gzip`åçš„åªæœ‰`2.5K`ã€‚

> TODOï¼šè¿™é‡Œçš„æ¯ä¸€ä¸ªç‰¹ç‚¹éƒ½åŠ ä¸Šdemoè¯´æ˜ã€‚

## å®‰è£…

```shell
npm install natty-storage --save
```

## nattyStorage(options)

åˆ›å»ºç¼“å­˜å¯¹è±¡çš„å®ä¾‹

```js
let storage = nattyStorage({
    async: true,          // æ˜¯å¦ä»¥å¼‚æ­¥æ–¹å¼ä½¿ç”¨
    type: 'localStorage', // ç¼“å­˜æ–¹å¼
    key: 'ChinaCity',     // !!! å”¯ä¸€å¿…é€‰çš„å‚æ•°ï¼Œç”¨äºå†…éƒ¨å­˜å‚¨
    tag: 'v1.0',          // ç¼“å­˜çš„æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆ
    duration: 1000*60*10, // ç¼“å­˜çš„æœ‰æ•ˆæœŸé•¿ï¼Œä»¥æ¯«ç§’æ•°æŒ‡å®š
    until: 1464759086797  // ç¼“å­˜çš„åˆ°æœŸæ—¶é—´ï¼Œä»¥å…·ä½“æ—¥æœŸæ—¶é—´çš„æ—¶é—´æˆ³æŒ‡å®š
});
```

### options

#### `async`(å¯é€‰)ï¼šå¸ƒå°”å€¼

æ˜¯å¦å¼€å¯å¼‚æ­¥æ–¹å¼ä½¿ç”¨ï¼Œé»˜è®¤ä¸º`false`ã€‚å¦‚æœå¼€å¯ï¼Œåˆ™`set/get/has/remove`å››ä¸ªæ–¹æ³•çš„è¿”å›å€¼éƒ½æ˜¯`Promise`å®ä¾‹ï¼Œå¯ä»¥è°ƒç”¨`then`æ–¹æ³•ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œä»¥åŒæ­¥æ–¹å¼ä½¿ç”¨

```js
let storage = nattyStorage({
    key: 'foo'
});
// è®¾ç½®å€¼
try {
    storage.set('x', 'x');
} catch (error) {
    // å¤„ç†é”™è¯¯
}
// è·å–å€¼
console.log(storage.get('x')); // => 'x'
```

å¼€å¯å¼‚æ­¥æ–¹å¼ä½¿ç”¨

```js
let storage = nattyStorage({
    async: true, // å¼€å¯å¼‚æ­¥æ–¹å¼ä½¿ç”¨
    key: 'foo'
});
// è®¾ç½®å€¼
storage.set('x', 'x').then(function(){
    // è·å–å€¼
    console.log(storage.get('x')); // => 'x'
}).catch(function(error){
    // å¤„ç†é”™è¯¯
});
```


#### `type`(å¯é€‰)ï¼šæšä¸¾å€¼

æŒ‡å®šç¼“å­˜å¯¹è±¡å­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼Œå¯é€‰å€¼ä¸º`localStorage`ã€`sessionStorage`å’Œ`variable`ã€‚é»˜è®¤ä¸º`localStorage`ã€‚

å½“æŒ‡å®š`type`ä¸º`localStorage/sessionStorage`ï¼Œä½†æµè§ˆå™¨çš„`localStorage/sessionStorage`ä¸å¯ç”¨æ—¶(æ¯”å¦‚éƒ¨åˆ†æµè§ˆå™¨çš„éšèº«æ¨¡å¼ä¸‹)ï¼Œåˆ™è‡ªåŠ¨é™çº§åˆ°`varable`æ–¹å¼å­˜å‚¨ã€‚

#### `key`(å¿…é€‰)ï¼šå­—ç¬¦ä¸²

æŒ‡å®šç¼“å­˜å¯¹è±¡å­˜å‚¨æ•°æ®æ‰€ä½¿ç”¨çš„å”¯ä¸€æ ‡è¯†ã€‚å¦‚æœä¸¤ä¸ªç¼“å­˜å¯¹è±¡çš„`key`å€¼ç›¸åŒï¼Œåˆ™ç¼“å­˜çš„æ•°æ®ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚

#### `tag`(å¯é€‰)ï¼šå­—ç¬¦ä¸²

é€šè¿‡ä¸€ä¸ªæ ‡è®°æ¥åˆ¤æ–­ç¼“å­˜å¯¹è±¡æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚`tag`ä¸åŒåˆ™ç¼“å­˜å¤±æ•ˆã€‚

> é€šå¸¸`tag`çš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·ã€‚

#### `duration`(å¯é€‰)ï¼šæ¯«ç§’æ•°

é€šè¿‡"æœ‰æ•ˆæœŸé•¿"æ¥åˆ¤æ–­ç¼“å­˜å¯¹è±¡æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚è¿‡æœŸåˆ™ç¼“å­˜å¤±æ•ˆï¼Œä¸è¿‡æœŸåˆ™é¡ºå»¶ã€‚

#### `until`(å¯é€‰)ï¼šæ—¶é—´æˆ³

é€šè¿‡"æœ‰æ•ˆæœŸè‡³"æ¥åˆ¤æ–­ç¼“å­˜å¯¹è±¡æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆã€‚è¿‡æœŸåˆ™ç¼“å­˜å¤±æ•ˆã€‚


## storage.set()

è®¾ç½®æ•°æ®åŒ…æ‹¬æ·»åŠ æ–°æ•°æ®å’Œä¿®æ”¹å·²æœ‰çš„æ•°æ®ï¼Œéƒ½å¾ˆæ–¹ä¾¿ã€‚

```js
// è®¾ç½®å®Œæ•´æ•°æ®
storage.set({x:'x'}).then(function(){
    // do something
}).catch(function(e){
    // deal the error
});

// è®¾ç½®ä»»æ„ç±»å‹çš„å®Œæ•´æ•°æ®
storage.set('x').then().catch();

// è®¾ç½®æŒ‡å®šé”®çš„æ•°æ®
storage.set('foo', 'x').then().catch();

// è®¾ç½®æŒ‡å®šè·¯å¾„çš„æ•°æ®
storage.set('foo.bar', 'x').then().catch();

// å¦‚æœè·¯å¾„ä¸­çš„æŸä¸ªé”®åŒ…å«`.`å·, è½¬ä¹‰å³å¯
storage.set('fo\\.o.bar', 'x').then().catch();
```

## storage.get()

è·å–æ•°æ®æ”¯æŒè·å–å…¨éƒ¨æ•°æ®å’Œä»¥è·¯å¾„æ–¹å¼è·å–éƒ¨åˆ†æ•°æ®ã€‚

```js
// è·å–å®Œæ•´æ•°æ®
storage.get().then(function(data){
    // do something with data
}).catch(function(e){
    // deal the error
});

// è·å–æŒ‡å®šçš„é”®çš„æ•°æ®
storage.get('foo').then().catch();

// è·å–æŒ‡å®šçš„è·¯å¾„çš„æ•°æ®
storage.get('foo.bar').then().catch();

// å¦‚æœè·¯å¾„ä¸­çš„æŸä¸ªé”®åŒ…å«`.`å·, è½¬ä¹‰å³å¯
storage.get('fo\\.o.bar').then().catch();
```

## storage.has()

åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨

```js
// æ ¹æ®æŒ‡å®šçš„è·¯å¾„ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
storage.has('x.y').then(function(result){
	// å­˜åœ¨
	// {
	//    has: true,
	//    value: 'value'
	// }
	//
	// ä¸å­˜åœ¨
	// {
	//    has: false,
	//    value: undefined
	// }
}).catch();

// ä¸æŒ‡å®šè·¯å¾„ï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®è¿‡å…¨é‡çš„å€¼
// å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡å…¨é‡çš„å€¼ï¼Œåˆæ²¡æœ‰æŒ‡å®šæŸ¥æ‰¾è·¯å¾„ï¼Œåˆ™æŠ¥é”™
storage.has().then().catch();
```

## storage.dump()

åœ¨æ§åˆ¶å°è¾“å‡ºå½“å‰`storage`å¯¹è±¡çš„æ•°æ®


## storage.remove()

åˆ é™¤æ•°æ®ä¼šåŒæ—¶åˆ é™¤æŒ‡å®šçš„é”®å’Œå¯¹åº”çš„å€¼ã€‚

```js
// åˆ é™¤è®¾ç½®æŒ‡å®šè·¯å¾„çš„æ•°æ®å’Œé”®
storage.remove('x.y').then().catch();

// æ¸…ç©ºæ•°æ®ä¸º{}
storage.remove().then().catch();
```

## storage.destroy()

é”€æ¯ç¼“å­˜å¯¹è±¡å®ä¾‹

```js
storage.destroy();
```

## å¤–éƒ¨ä¾èµ–

`nattyStorage`ä¾èµ–ç°ä»£æµè§ˆå™¨çš„ä¸¤ä¸ªå¯¹è±¡ã€‚åœ¨éç°ä»£æµè§ˆå™¨ä¸‹ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥`polyfill`è§£å†³ã€‚

* `Promise`å¯¹è±¡ï¼Œæ¨èçš„`polyfill`ï¼š[lie](https://github.com/calvinmetcalf/lie)
* `JSON`å¯¹è±¡ï¼Œæ¨èçš„`polyfill`ï¼š[json2](https://github.com/douglascrockford/JSON-js)

## IE8å’ŒIE9çš„å…¼å®¹æ€§

å¦‚æœéœ€è¦å…¼å®¹`IE8`å’Œ`IE9`ï¼Œéœ€è¦å¼•å…¥`es5-shim`å’Œ`es5-sham`ã€‚

å®‰è£…

```shell
npm install es5-shim --save
```

å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°`nattyStorage`æ ‡ç­¾ä¹‹å‰

```html
<!--[if lt IE 10]>
<script type="text/javascript" src="./node_modules/es5-shim/es5-shim.min.js"></script>
<script type="text/javascript" src="./node_modules/es5-shim/es5-sham.min.js"></script>
<![endif]-->
```

## Next TODO

* æ·»åŠ é™æ€æ–¹æ³•`nattyStorage.clean()`ï¼Œæ¸…ç†å¤±æ•ˆçš„ç¼“å­˜ã€‚
  - æœ‰æ•ˆæœŸé•¿(`duration`)å·²åˆ°ï¼Œåˆ é™¤ã€‚
  - æœ‰æ•ˆæœŸè‡³(`until`)å·²è¿‡ï¼Œåˆ é™¤ã€‚
  - å…¶ä»–å¾…å®šï¼šæœ€åè¯»å–æ—¥æœŸè¶…è¿‡æŒ‡å®šæ—¶é—´(æ¯”å¦‚ï¼šä¸€å‘¨)çš„ï¼Œåˆ é™¤ã€‚
* æ·»åŠ é™æ€æ–¹æ³•`nattyStorage.list()`ï¼Œåˆ—å‡ºå½“å‰é¡µé¢æ‰€æœ‰çš„ç”±`natty-storage`æ‰€åˆ›å»ºçš„ç¼“å­˜æ•°æ®ã€‚

## dev

æŠŠä»£ç `clone`åˆ°æœ¬åœ°ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š

```shell
npm install
npm start
```

## build

```shell
npm run build
```
